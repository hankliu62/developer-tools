# 图片压缩工具 - Product Spec

## 一、产品定位

| 项目 | 内容 |
|------|------|
| 产品名称 | Image Compressor Pro |
| 产品类型 | 工具类 Web 应用 |
| 一句话定位 | 免费的 AI 智能图片压缩工具，支持批量处理和多种格式 |
| 核心价值 | 本地处理隐私安全 + AI 智能推荐参数 + 压缩效果可视化对比 |
| 目标用户 | 设计师、运营人员、普通用户 |

## 二、目标用户画像

| 用户类型 | 使用场景 | 核心需求 |
|----------|----------|----------|
| 设计师 | 压缩设计稿、导出作品集 | 质量优先、可调参数多 |
| 运营人员 | 压缩活动图片、上传素材 | 批量处理、快速上手 |
| 普通用户 | 压缩照片、头像、表情包 | 简单易用、隐私安全 |

## 三、核心功能清单

### 3.1 必须功能 (MVP)

| 功能点 | 功能描述 | 优先级 |
|--------|----------|--------|
| 图片上传 | 支持拖拽上传、点击上传、单文件/批量上传 | P0 |
| 本地压缩 | 使用浏览器 Canvas + WebAssembly 进行图片压缩 | P0 |
| 参数调节 | 质量滑块 (0-100)、输出格式选择、缩放比例 | P0 |
| 对比预览 | 左右分屏对比 + 滑块拖动对比 | P0 |
| 图片下载 | 单张下载、批量打包下载 (ZIP) | P0 |
| 格式转换 | 支持 JPEG/PNG/WebP/GIF/AVIF 格式输出 | P0 |
| 批量管理 | 批量上传、列表展示、逐张/批量压缩 | P0 |

### 3.2 AI 增强功能

| 功能点 | 功能描述 | 优先级 |
|--------|----------|--------|
| AI 智能识别 | 自动识别图片类型（人像、截图、照片、插画、图表） | P1 |
| AI 参数推荐 | 根据图片类型自动推荐最佳压缩参数 | P1 |
| API Key 管理 | 用户自行配置智谱 GLM / Google Gemini API Key | P1 |

### 3.3 高级功能 (可选)

| 功能点 | 功能描述 | 优先级 |
|--------|----------|--------|
| 压缩预设 | 人像模式、截图模式、照片模式、网页优化 | P2 |
| 历史记录 | 记录压缩历史（可选，本地存储） | P2 |
| 复制结果 | 一键复制压缩后的图片到剪贴板 | P2 |

## 四、功能详细说明

### 4.1 图片上传

- 支持格式：JPEG, PNG, WebP, GIF, AVIF, HEIC, BMP, TIFF
- 单文件大小限制：20MB
- 批量上传数量限制：50 张
- 上传方式：拖拽上传 + 点击选择
- 反馈：上传进度条、预览缩略图

### 4.2 参数调节

| 参数 | 类型 | 范围/选项 | 默认值 |
|------|------|-----------|--------|
| 压缩质量 | 滑块 | 0-100 | 80 |
| 输出格式 | 下拉框 | 原格式 / JPEG / PNG / WebP / GIF / AVIF | 原格式 |
| 缩放比例 | 下拉框 | 原图 / 50% / 75% / 80% / 90% | 原图 |
| 保留元数据 | 开关 | ON/OFF | OFF |
| 渐进式 JPEG | 开关 | ON/OFF | OFF |
| PNG 优化 | 开关 | ON/OFF | ON |

### 4.3 AI 智能模式

- **触发方式**：用户点击"AI 智能压缩"按钮
- **识别内容**：
  - 图片类型：人像、截图、照片、插画、图表、文档、二维码
  - 图片特征：是否有文字、是否有透明度、是否为纯色图
- **推荐参数逻辑**：
  - 人像 → 质量 85%，保留色彩，PNG 或 JPEG
  - 截图 → 质量 75%，WebP，缩放 80%
  - 照片 → 质量 90%，保留细节，JPEG
  - 插画 → 质量 80%，PNG 或 WebP
  - 图表 → 质量 70%，高对比度保留

### 4.4 对比预览

- **模式 1**：左右分屏，左侧原图，右侧压缩后
- **模式 2**：滑块拖动，鼠标拖动滑块查看前后对比
- **信息展示**：
  - 原图大小、尺寸
  - 压缩后大小、尺寸
  - 压缩率（百分比）
  - 预估加载时间对比（按 4G 网络）

### 4.5 下载功能

- 单张下载：点击下载按钮，直接下载当前图片
- 批量下载：打包成 ZIP 文件下载
- 另存为：选择不同格式保存

## 五、用户流程

### 5.1 单张压缩流程

```
1. 用户进入页面
      ↓
2. 拖拽图片到上传区 / 点击上传按钮
      ↓
3. 图片加载，显示原图预览
      ↓
4. [可选] 用户调节参数 / 点击"AI 智能压缩"
      ↓
5. 点击"压缩"按钮
      ↓
6. 显示压缩进度
      ↓
7. 压缩完成，显示对比预览 + 压缩信息
      ↓
8. 用户下载 / 继续上传下一张
```

### 5.2 批量压缩流程

```
1. 用户进入页面
      ↓
2. 批量上传多张图片
      ↓
3. 显示图片列表（缩略图 + 原大小）
      ↓
4. [可选] 全选/逐个选择要压缩的图片
      ↓
5. [可选] 调节统一参数 / 对每张图片单独设置
      ↓
6. 点击"批量压缩"
      ↓
7. 显示压缩进度（总进度 + 当前处理）
      ↓
8. 压缩完成，显示列表（每张的压缩后大小 + 压缩率）
      ↓
9. 逐张预览 / 批量打包下载
```

## 六、页面布局

### 6.1 整体布局

```
┌─────────────────────────────────────────────────────┐
│  顶部：Logo ("Image Compressor") + 设置按钮         │
├─────────────────────────────────────────────────────┤
│  上传区：                                          │
│  ┌─────────────────────────────────────────────┐   │
│  │                                              │   │
│  │         拖拽图片到此处 或 点击上传            │   │
│  │         支持 JPEG/PNG/WebP/GIF/AVIF         │   │
│  │                                              │   │
│  └─────────────────────────────────────────────┘   │
│  [批量上传] [最多 50 张，每张最大 20MB]           │
├─────────────────────────────────────────────────────┤
│  参数区：[AI 智能压缩] [展开更多选项 ▼]            │
│  ┌─────────────────────────────────────────────┐   │
│  │  质量: [====○====] 80    格式: [JPEG ▼]    │   │
│  │  缩放: [原图 ▼]        [保留元数据 ○]       │   │
│  │  [压缩]                                        │   │
│  └─────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────┤
│  对比区（单张模式）：                              │
│  ┌────────────────────┐ ┌────────────────────┐   │
│  │      原图          │ │     压缩后         │   │
│  │      预览          │ │     预览           │   │
│  └────────────────────┘ └────────────────────┘   │
│  [←] 1/3 [→]              [滑块拖动对比]          │
├─────────────────────────────────────────────────────┤
│  信息区：                                          │
│  原图: 2.5MB → 压缩后: 520KB  节省: 79%          │
│  尺寸: 1920×1080 → 1920×1080  加载时间: 2.1s     │
├─────────────────────────────────────────────────────┤
│  操作区：[下载当前] [另存为] [批量打包下载]        │
└─────────────────────────────────────────────────────┘
```

### 6.2 批量模式布局

```
┌─────────────────────────────────────────────────────┐
│  顶部：Logo + 返回单张模式                          │
├─────────────────────────────────────────────────────┤
│  参数区：[统一参数设置]                             │
│  质量: [====○====] 80    格式: [保持原格式 ▼]    │
├─────────────────────────────────────────────────────┤
│  图片列表：                                         │
│  ┌────┬────────────┬──────────┬──────────┬──────┐│
│  │ ☑  │ 缩略图    │ 原大小   │ 压缩后   │ 操作 ││
│  ├────┼────────────┼──────────┼──────────┼──────┤│
│  │ ☑  │ [图片]    │ 2.5MB   │ 520KB   │ 👁  ││
│  │ ☑  │ [图片]    │ 1.8MB   │ 380KB   │ 👁  ││
│  │ ☑  │ [图片]    │ 3.2MB   │ 780KB   │ 👁  ││
│  └────┴────────────┴──────────┴──────────┴──────┘│
│  已选 3 张，总计: 7.5MB → 1.68MB (节省 78%)      │
├─────────────────────────────────────────────────────┤
│  操作区：[压缩全部] [下载ZIP)]                │
全部 (└─────────────────────────────────────────────────────┘
```

### 6.3 设置面板（点击右上角设置按钮展开）

```
┌─────────────────────────────────────┐
│  设置                               │
├─────────────────────────────────────┤
│  AI API 配置：                      │
│  [API Key 输入框]                   │
│  [选择模型: 智谱 GLM-4-Flash ▼]    │
│  [保存]                             │
│                                     │
│  说明：                             │
│  AI 智能压缩需要配置 API Key        │
│  支持智谱 GLM 和 Google Gemini      │
└─────────────────────────────────────┘
```

## 七、控件规范

### 7.1 输入控件

| 控件 | 规范 |
|------|------|
| 质量滑块 | 宽度 200px，步长 1，显示当前值标签 |
| 格式下拉 | 宽度 120px，选项：原格式/JPEG/PNG/WebP/GIF/AVIF |
| 缩放下拉 | 宽度 100px，选项：原图/50%/75%/80%/90% |
| 开关 | 宽度 44px，高度 22px，滑动动画 |
| 上传按钮 | 主按钮样式，主色调 #6366f1 (indigo-500) |
| 压缩按钮 | 主按钮样式，宽度 120px，禁用时灰色 |

### 7.2 按钮样式

| 按钮 | 样式 |
|------|------|
| 主按钮 (压缩/下载) | 背景 #6366f1，白色文字，圆角 8px，hover 加深 10% |
| 次按钮 (另存为/设置) | 边框 #d1d5db，文字 #374151，hover 背景 #f3f4f6 |
| 图标按钮 (删除/预览) | 圆形，32px，hover 背景 #f3f4f6 |

### 7.3 卡片/面板

| 元素 | 规范 |
|------|------|
| 上传区卡片 | 虚线边框 #d1d5db，圆角 12px，hover 边框 #6366f1 |
| 图片预览卡片 | 白色背景，圆角 8px，阴影 sm，hover 阴影 md |
| 参数面板 | 白色背景，圆角 12px，分隔线 #e5e7eb |

### 7.4 颜色规范

| 用途 | 颜色 |
|------|------|
| 主色 | #6366f1 (indigo-500) |
| 主色 hover | #4f46e5 (indigo-600) |
| 成功色 | #10b981 (emerald-500) |
| 警告色 | #f59e0b (amber-500) |
| 错误色 | #ef4444 (red-500) |
| 背景色 | #f9fafb (gray-50) |
| 文字主色 | #111827 (gray-900) |
| 文字次色 | #6b7280 (gray-500) |
| 边框色 | #e5e7eb (gray-200) |

### 7.5 间距规范

| 元素 | 间距 |
|------|------|
| 页面边距 | 24px (移动端 16px) |
| 区域间距 | 32px |
| 控件间距 | 16px |
| 卡片内边距 | 20px |

## 八、技术实现

### 8.1 前端技术栈

- **框架**：Next.js 16 (App Router)
- **UI 库**：React + Tailwind CSS + Ant Design
- **图片处理**：
  - 浏览器 Canvas API
  - browser-image-compression
  - @ffmpeg/ffmpeg (AVIF 支持)
- **状态管理**：React hooks (useState, useReducer)

### 8.2 AI 能力配置

#### 使用智谱 GLM API

```javascript
// API 端点：https://open.bigmodel.cn/api/paas/v4/chat/completions
// 模型：glm-4-flash
// 调用方式：用户自行配置 API Key，前端调用后端 API 代理
```

#### 使用 Google Gemini API

```javascript
// API 端点：https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent
// 模型：gemini-1.5-flash / gemini-2.0-flash
// 调用方式：用户自行配置 API Key，前端调用后端 API 代理
```

### 8.3 后端 API 路由

```typescript
// /api/image-compressor/compress
// POST
// 输入：图片文件 + 压缩参数
// 输出：压缩后的图片 Blob

// /api/ai-analyze
// POST
// 输入：图片文件
// 输出：图片类型识别结果 + 推荐参数
```

### 8.4 隐私处理

- 所有图片压缩在浏览器本地完成，不上传服务器
- 压缩后的图片即时下载，不存储
- AI 分析仅发送图片特征数据（Base64 缩略图），不发送原图

## 九、非功能需求

### 9.1 性能要求

| 指标 | 要求 |
|------|------|
| 首屏加载 | < 2s (4G 网络) |
| 单张压缩 (5MB) | < 3s |
| 批量压缩 (10 张) | < 30s |
| 内存占用 | < 500MB |

### 9.2 兼容性

| 环境 | 要求 |
|------|------|
| Chrome | >= 90 |
| Firefox | >= 90 |
| Safari | >= 15 |
| Edge | >= 90 |
| 移动端 | iOS Safari >= 15, Chrome Android >= 90 |

### 9.3 辅助功能

- 支持键盘导航
- 图片 alt 文字说明
- 按钮有 focus 状态
- 对比度符合 WCAG AA 标准

## 十、上线计划

### Phase 1 - MVP (Week 1-2)

- [x] 图片上传（单张 + 批量）
- [x] 基本压缩功能
- [x] 参数调节（质量 + 格式 + 缩放）
- [x] 对比预览
- [x] 下载功能

### Phase 2 - AI 增强 (Week 3)

- [ ] AI 智能识别图片类型
- [ ] AI 推荐压缩参数
- [ ] API Key 管理

### Phase 3 - 优化 (Week 4)

- [ ] 压缩预设
- [ ] 历史记录
- [ ] 性能优化

## 十一、总结

本产品定位为一款免费、隐私安全的 AI 智能图片压缩工具。核心差异化在于：

1. **本地处理**：图片不经过服务器，用户隐私有保障
2. **AI 智能**：自动识别图片类型，推荐最佳压缩参数
3. **可视化对比**：滑块拖动对比，直观展示压缩效果
4. **免费使用**：无任何限制，降低用户使用门槛

变现方式可后期考虑：广告位、AI 高级功能付费、增值服务等。
