# 故事会 - Product Spec

## 1. 产品概述

### 1.1 产品定位

为家长提供睡前故事浏览、搜索、AI智能辅助（朗读、续写、总结）的儿童故事工具。

### 1.2 目标用户

- **主要用户**：家长（给孩子讲睡前故事）
- **使用场景**：
  1. 家长给孩子讲睡前故事时浏览故事
  2. 根据分类查找适合的故事
  3. 搜索特定主题的故事
  4. AI 朗读故事（家长省力）
  5. AI 续写故事（增加趣味）
  6. AI 总结故事寓意（家长讲解）

### 1.3 核心价值

家长可以快速找到适合孩子的故事，AI 功能减轻讲故事的压力，续写功能增加故事趣味性。

---

## 2. 功能需求

### 2.1 核心功能列表

#### 功能1：分类展示

- **描述**：顶部搜索框下方展示故事分类标签，点击分类筛选故事
- **输入**：点击分类标签
- **输出**：更新故事列表，显示该分类下的故事
- **AI能力**：无

#### 功能2：故事搜索

- **描述**：搜索框输入关键字，按回车搜索
- **输入**：搜索关键字
- **输出**：搜索结果故事列表
- **搜索规则**：
  - 选中分类时：当前分类下搜索
  - 未选中分类时：全局搜索
- **AI能力**：无

#### 功能3：故事列表展示

- **描述**：以卡片网格形式展示故事，每个卡片显示：标题、类型、阅读时长、故事摘要（前3行）
- **输入**：无（页面加载或分类/搜索切换）
- **输出**：故事卡片列表
- **分页方式**：滚动加载更多（无限滚动）
- **AI能力**：无

#### 功能4：故事详情页面

- **描述**：点击故事卡片，新页面打开详情
- **输入**：点击故事卡片
- **输出**：故事详情页面，包含完整故事内容
- **页面内容**：
  - 标题、类型、阅读时长
  - 完整故事内容
  - AI 功能区（朗读、续写、总结）

#### 功能5：首页 AI 功能（跟随故事卡片）

- **描述**：在故事卡片上显示 AI 朗读和 AI 总结按钮，点击后对该故事进行操作
- **输入**：点击 AI 按钮
- **输出**：
  - AI 朗读：播放语音
  - AI 总结：显示故事寓意
- **AI能力**：TTS（语音生成）、文本生成

#### 功能6：详情页 AI 朗读

- **描述**：点击"AI 朗读"按钮，将故事内容转为语音播放
- **输入**：点击 AI 朗读按钮
- **输出**：播放语音
- **播放控制**：
  - 播放/暂停按钮
  - 进度条（可拖拽）
  - 循环播放开关
  - 播放次数选择（1次、2次、3次、无限）
  - 重新播放按钮
- **AI能力**：文本转语音（TTS）

#### 功能7：详情页 AI 续写

- **描述**：点击"AI 续写"按钮，AI 根据原故事生成续写内容
- **输入**：点击 AI 续写按钮
- **输出**：显示续写内容，标注"AI 续写"
- **显示方式**：单独区域显示在原文下方
- **AI能力**：文本生成

#### 功能8：详情页 AI 总结

- **描述**：点击"AI 总结"按钮，AI 生成故事的寓意/教育意义
- **输入**：点击 AI 总结按钮
- **输出**：显示故事寓意总结
- **AI能力**：文本生成

### 2.2 AI 增强功能

#### AI 增强点1：AI 朗读（TTS）

- **原始功能**：家长朗读故事
- **AI 增强方式**：TTS 将故事内容转为语音播放
- **使用场景**：
  - 首页故事卡片上点击"朗读"
  - 详情页点击"AI 朗读"
- **播放控制**：播放/暂停、进度条、循环、播放次数

#### AI 增强点2：AI 续写

- **原始功能**：阅读现有故事
- **AI 增强方式**：根据原故事生成续写内容
- **使用场景**：详情页点击"AI 续写"
- **输出格式**：原文下方单独区域，标注"AI 续写"

#### AI 增强点3：AI 总结

- **原始功能**：家长自行理解故事寓意
- **AI 增强方式**：一键生成故事寓意/教育意义
- **使用场景**：
  - 首页故事卡片上点击"总结"
  - 详情页点击"AI 总结"

---

## 3. 用户流程

### 3.1 主要用户流程

**流程名称**：浏览并阅读故事

1. **步骤1**：进入首页
   - 用户操作：打开页面
   - 系统响应：加载分类列表和默认故事列表
   - 界面状态：顶部搜索框 + 分类标签 + 故事卡片网格

2. **步骤2**：选择分类
   - 用户操作：点击分类标签
   - 系统响应：加载该分类下的故事列表
   - 界面状态：故事列表更新

3. **步骤3**：搜索故事
   - 用户操作：在搜索框输入关键字，按回车
   - 系统响应：根据当前分类搜索（若有分类）或全局搜索
   - 界面状态：显示搜索结果列表

4. **步骤4**：浏览故事卡片
   - 用户操作：滚动查看故事卡片
   - 系统响应：显示故事卡片（标题、类型、时长、摘要）
   - 界面状态：卡片网格布局

5. **步骤5**：首页 AI 操作
   - 用户操作：点击故事卡片上的"朗读"或"总结"
   - 系统响应：
     - 朗读：播放语音
     - 总结：显示故事寓意
   - 界面状态：弹出结果或显示摘要

6. **步骤6**：查看详情
   - 用户操作：点击故事卡片（不是 AI 按钮）
   - 系统响应：新页面打开故事详情
   - 界面状态：详情页包含完整内容和 AI 功能区

7. **步骤7**：详情页 AI 操作
   - 用户操作：点击 AI 功能按钮（朗读/续写/总结）
   - 系统响应：执行对应 AI 功能
   - 界面状态：显示 AI 结果

### 3.2 异常流程

**异常情况1**：API 请求失败
- **触发条件**：网络问题或接口返回错误
- **处理方式**：显示错误提示，提供重试按钮

**异常情况2**：无搜索结果
- **触发条件**：搜索无匹配故事
- **处理方式**：显示"未找到相关故事"提示

**异常情况3**：AI 功能未配置 API Key
- **触发条件**：用户点击 AI 功能但未配置 API Key
- **处理方式**：弹出设置窗口提示配置

**异常情况4**：AI 生成失败
- **触发条件**：AI 服务调用失败
- **处理方式**：显示错误提示，提供重试按钮

---

## 4. UI/UX 设计

### 4.1 整体布局

**布局类型**：单栏上下布局

**布局结构**：
```
┌─────────────────────────────────────┐
│            搜索区域                  │
│    [🔍 搜索故事...        ] [搜索]   │
├─────────────────────────────────────┤
│         分类标签区域                  │
│  [全部] [睡前故事] [儿童故事] [格林童话] ... │
├─────────────────────────────────────┤
│         故事卡片网格                  │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐│
│  │ 标题    │ │ 标题    │ │ 标题    ││
│  │ 类型    │ │ 类型    │ │ 类型    ││
│  │ 00:02:07│ │ 00:02:07│ │ 00:02:07││
│  │ 摘要... │ │ 摘要... │ │ 摘要... ││
│  │ [🔊] [📝]│ │ [🔊] [📝]│ │ [🔊] [📝]││
│  └─────────┘ └─────────┘ └─────────┘│
│  ... 更多卡片 ...                    │
└─────────────────────────────────────┘
```

**详情页布局**：
```
┌─────────────────────────────────────┐
│  ← 返回    故事详情    [🔊] [📝] [📋] │
│         (朗读) (续写) (总结)          │
├─────────────────────────────────────┤
│  标题：小老鼠打电话                   │
│  类型：睡前故事 | 时长：00:02:07      │
├─────────────────────────────────────┤
│  故事内容...                         │
│                                     │
├─────────────────────────────────────┤
│  AI 续写区域（点击续写后显示）        │
│  ┌───────────────────────────────┐  │
│  │ AI 续写                       │  │
│  │ 续写内容...                   │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

### 4.2 页面详细设计

#### 首页

**搜索区域**：
- 搜索框：宽度 100%，圆角，输入后按回车搜索
- 占位符："搜索故事..."

**分类标签**：
- 横向滚动标签栏
- 选中状态：主色调背景
- 未选中状态：灰色背景

**故事卡片**：
- 卡片布局：网格（2-3列，响应式）
- 内容：标题、类型、阅读时长（00:02:07）、摘要（前3行）
- AI 按钮：朗读图标 + 总结图标，底部横向排列
- 点击卡片：打开详情页（新窗口）

**滚动加载**：
- 滚动到底部自动加载更多
- 加载中显示加载提示

#### 详情页

**头部区域**：
- 返回按钮（左侧）
- 页面标题（居中）
- AI 功能按钮（右侧）：朗读、续写、总结

**故事内容**：
- 标题：大字
- 元信息：类型 + 阅读时长
- 正文：段落格式

**AI 续写区域**：
- 点击后展开
- 标注"AI 续写"标题
- 续写内容显示在原文下方

### 4.3 控件规范

| 控件 | 规范 |
|------|------|
| 搜索框 | 宽度 100%，圆角 8px，高度 44px |
| 分类标签 | 高度 36px，padding 0 16px，选中主色调填充 |
| 故事卡片 | 白色背景，圆角 12px，阴影，hover 上浮 |
| AI 按钮 | 图标按钮，24x24px |
| 播放控制条 | 进度条 + 时间显示 + 循环开关 + 次数选择 |
| 加载更多 | 滚动到底部自动触发，底部显示加载中 |

---

## 5. 智谱AI 能力配置

### 5.1 使用的 AI 能力列表

| AI 能力 | 用途 | 使用场景 |
|---------|------|----------|
| GLM-4-Flash（TTS） | 文本转语音，朗读故事 | 用户点击"朗读"按钮时 |
| GLM-4-Flash（文本生成） | 续写故事内容 | 用户点击"续写"按钮时 |
| GLM-4-Flash（文本生成） | 总结故事寓意 | 用户点击"总结"按钮时 |

### 5.2 能力配置说明

**能力1：TTS 语音生成**
- **模型**：推荐使用第三方 TTS API（如有）
- **备选**：智谱 GLM 文本生成，将故事内容转为音频 base64 返回
- **调用时机**：用户点击"朗读"按钮时
- **输入格式**：故事标题 + 故事内容
- **输出格式**：音频 URL 或 base64

**能力2：故事续写**
- **模型**：glm-4-flash
- **temperature**：0.8（适度创意）
- **max_tokens**：1000
- **调用时机**：用户点击"AI 续写"按钮时
- **输入格式**：原故事内容
- **输出格式**：续写文本

**Prompt 示例**：
```
请根据以下睡前故事，续写一个适合儿童的结尾（100-200字）：
故事标题：{title}
故事内容：{content}
```

**能力3：故事总结**
- **模型**：glm-4-flash
- **temperature**：0.7
- **max_tokens**：500
- **调用时机**：用户点击"AI 总结"按钮时
- **输入格式**：原故事内容
- **输出格式**：寓意总结

**Prompt 示例**：
```
请用简洁的语言总结这个故事的寓意（适合家长理解后讲给孩子听，50-100字）：
故事标题：{title}
故事内容：{content}
```

**API 配置**：
- API 地址：https://open.bigmodel.cn/api/paas/v4/
- 认证方式：API Key（用户自行配置，前端传入）
- 请求方式：POST

**后端 API 封装**：
- `/api/ai/story-tts` - 语音合成
- `/api/ai/story-continue` - 故事续写
- `/api/ai/story-summary` - 故事总结
- API Key 由用户在前端配置

---

## 6. 技术需求

### 6.1 技术要求

- 依赖 mxnzp API 获取故事数据
- API 配置从环境变量读取 app_id 和 app_secret
- 故事数据缓存到 localStorage
- 用户需在前端配置智谱AI API Key（保存到 localStorage）

### 6.2 API 接口

| 接口 | 用途 |
|------|------|
| GET /api/story/types | 获取分类列表 |
| GET /api/story/list | 获取故事列表（支持分类+搜索+分页） |
| GET /api/story/search | 全局搜索故事 |
| GET /api/story/details | 获取故事详情 |

### 6.3 性能要求

| 指标 | 要求 |
|------|------|
| 首屏加载 | < 2s |
| 搜索响应 | < 1s |
| 滚动加载 | 无感知 |
| AI 生成 | < 5s |

### 6.4 数据缓存

- 分类列表缓存：30 天
- 故事列表缓存：7 天
- 故事详情缓存：30 天
- API Key 缓存：无过期

---

## 7. 优先级规划

### 7.1 第一期（MVP）

- [x] 分类展示
- [x] 故事搜索（回车搜索，分类/全局）
- [x] 故事列表（卡片网格，摘要显示）
- [x] 滚动加载更多
- [x] 故事详情页（新窗口）
- [x] 首页 AI 朗读（跟随卡片）
- [x] 首页 AI 总结（跟随卡片）
- [x] 详情页 AI 朗读（播放控制）
- [x] 详情页 AI 续写
- [x] 详情页 AI 总结
- [x] API Key 配置

### 7.2 第二期

- [ ] 故事收藏功能
- [ ] 阅读历史记录
- [ ] 故事分享功能

### 7.3 未来规划

- [ ] AI 生成插图
- [ ] 儿童模式（护眼色）
- [ ] 定时关闭（睡前听故事）

---

## 8. 参考产品

### 8.1 参考产品列表

- **喜马拉雅儿童**：参考故事内容展示方式
- **凯叔讲故事**：参考 AI 功能设计

### 8.2 差异化说明

本产品差异化点：
1. 分类 + 搜索 + 无限滚动
2. 首页 AI 功能跟随故事卡片
3. 详情页三个独立 AI 功能
4. TTS 播放控制（循环、次数）
5. AI 续写单独区域展示

---

## 9. 待补充事项

- [x] 所有必填项已补充完整

---

## 附录：使用说明

1. **配置 API**：在环境变量中配置 mxnzp API 的 app_id 和 app_secret
2. **用户配置 API Key**：用户需在前端设置中配置智谱AI API Key
3. **调用后端接口**：前端通过 `/api/ai/story-*` 接口调用 AI 能力
4. **实现功能**：按照「功能需求」和「用户流程」部分实现功能
5. **设计界面**：按照「UI/UX 设计」部分实现界面布局和交互
