# Image2ICO - Product Spec

## 1. 产品概述

### 1.1 产品定位
一个图片转 ICO/PNG Favicon 工具，支持多种上传方式和 AI 图像增强（智能裁剪、背景去除、图像增强）。AI 功能需要用户输入智谱 AI API Key。

### 1.2 目标用户
- **主要用户**：前端开发者、网站运营者、个人站长
- **使用场景**：
  1. 开发新网站需要生成 favicon.ico
  2. 给现有网站更换图标
  3. 需要多种尺寸的 favicon 用于不同场景
  4. 图片不合适需要 AI 处理后再转换

### 1.3 核心价值
- 一键转换：上传图片即可生成 ICO/PNG 格式的 favicon
- 多尺寸输出：一次生成多种常用尺寸
- AI 增强：智能裁剪、背景去除、图像增强，提升图标质量（需配置 API Key）

---

## 2. 功能需求

### 2.1 核心功能列表

#### 功能1：图片上传
- **描述**：支持多种方式上传图片
- **输入**：图片文件或图片 URL
- **上传方式**：
  - 拖拽上传：将图片拖拽到上传区域
  - 点击选择：点击上传区域选择文件
  - 粘贴上传：Ctrl+V 粘贴剪贴板图片
  - URL 输入：输入图片地址加载
- **支持格式**：PNG、JPG、JPEG、WebP、GIF、BMP、SVG

#### 功能2：图片转 ICO
- **描述**：将图片转换为 ICO 格式
- **输入**：上传的图片
- **输出**：ICO 格式文件
- **可选尺寸**：16x16, 24x24, 32x32, 48x48, 64x64, 128x128, 256x256
- **输出方式**：单文件（包含多尺寸）或单独下载各尺寸

#### 功能3：图片转 PNG Favicon
- **描述**：将图片转换为 PNG 格式 favicon
- **输入**：上传的图片
- **输出**：PNG 格式文件
- **可选尺寸**：16x16, 32x32, 48x48, 64x64, 128x128, 192x192, 512x512

#### 功能4：AI 智能裁剪
- **描述**：自动识别图片主体，裁剪出最适合作为图标的部分
- **输入**：上传的图片
- **输出**：裁剪后的图片
- **AI能力**：图像识别 + 智能裁剪

#### 功能5：AI 背景去除
- **描述**：自动去除图片背景，只保留主体
- **输入**：上传的图片
- **输出**：透明背景的图片
- **AI能力**：图像分割 + 背景去除

#### 功能6：AI 图像增强
- **描述**：提升图片清晰度和质量
- **输入**：模糊或低质量的图片
- **输出**：增强后的图片
- **AI能力**：图像超分辨率 + 清晰度增强

### 2.2 AI 增强功能

#### AI 增强点1：AI 智能裁剪
- **原始功能**：图片上传后预处理
- **AI 增强方式**：自动识别图片主体区域，智能裁剪成正方形
- **使用场景**：用户上传的图片主体不在正中央或比例不对

#### AI 增强点2：AI 背景去除
- **原始功能**：图片上传后预处理
- **AI 增强方式**：自动检测并去除背景，保留主体
- **使用场景**：用户上传的图片有背景色，不适合直接做图标

#### AI 增强点3：AI 图像增强
- **原始功能**：图片转 ICO/PNG 之前
- **AI 增强方式**：对模糊图片进行超分辨率重建，提升清晰度
- **使用场景**：用户上传的图片比较模糊，直接转换效果不好

---

## 3. 用户流程

### 3.1 主要用户流程

**流程名称**：图片转 ICO/Favicon 标准流程

1. **上传图片**
   - 用户操作：拖拽/点击/粘贴/URL 方式上传图片
   - 系统响应：显示图片预览
   - 界面状态：上传区域显示图片缩略图

2. **（可选）AI 增强**
   - 用户操作：选择 AI 功能按钮（裁剪/去背景/增强）
   - 系统响应：调用 AI API 处理图片
   - 界面状态：显示处理中的 loading，处理完成后更新预览

3. **选择输出格式**
   - 用户操作：勾选 ICO 或 PNG 或两者都选
   - 系统响应：记录用户选择
   - 界面状态：显示已选格式

4. **选择输出尺寸**
   - 用户操作：勾选需要的尺寸（可多选）
   - 系统响应：记录用户选择
   - 界面状态：显示已选尺寸列表

5. **生成并下载**
   - 用户操作：点击"生成"按钮
   - 系统响应：转换图片，生成对应格式和尺寸的文件
   - 界面状态：显示生成结果，提供下载按钮

### 3.2 异常流程

**异常情况1**：图片格式不支持
- **触发条件**：上传不支持的图片格式
- **处理方式**：显示错误提示，列出支持的格式

**异常情况2**：图片太大
- **触发条件**：上传超过 10MB 的图片
- **处理方式**：显示错误提示，建议压缩后上传

**异常情况3**：AI 处理失败
- **触发条件**：AI API 返回错误
- **处理方式**：显示"处理失败，请重试"提示

**异常情况4**：网络错误
- **触发条件**：网络连接失败
- **处理方式**：显示网络错误提示

---

## 4. UI/UX 设计

### 4.1 整体布局

**布局类型**：单栏布局（移动端适配）

**布局结构**：
```
┌─────────────────────────────────────┐
│            Header                    │
│     图片转ICO / Image to ICO        │
├─────────────────────────────────────┤
│                                     │
│      【上传区域】                    │
│      拖拽/点击/粘贴/URL             │
│      支持 PNG/JPG/WebP/SVG 等       │
│                                     │
├─────────────────────────────────────┤
│                                     │
│      【图片预览区】                  │
│      显示上传的图片                  │
│      [AI裁剪] [AI去背景] [AI增强]  │
│                                     │
├─────────────────────────────────────┤
│                                     │
│      【输出设置区】                  │
│      格式: ☑ICO  ☑PNG             │
│      尺寸: ☐16 ☐32 ☐48 ☐64       │
│            ☐128 ☐256               │
│                                     │
│           [生成 ICO]                │
│                                     │
├─────────────────────────────────────┤
│                                     │
│      【结果预览区】                  │
│      显示生成的 ICO/PNG             │
│      [下载] [复制]                  │
│                                     │
└─────────────────────────────────────┘
```

**各区域说明**：
- **Header**：固定顶部，显示标题
- **上传区域**：大拖拽区域，支持多种上传方式
- **预览区**：显示图片 + AI 功能按钮
- **输出设置区**：格式和尺寸选择
- **结果区**：生成后显示预览和下载

### 4.2 页面详细设计

#### 页面1：主页面

**布局**：
- 上半部分：上传区域 + 图片预览 + AI 功能
- 下半部分：输出设置 + 生成按钮 + 结果展示

**上传区域**：
- 尺寸：宽度 100%，高度 200px
- 样式：虚线边框，圆角 16px，拖拽时高亮
- 支持：拖拽、点击、粘贴、URL 输入
- 图标：上传图标 + 提示文字

**图片预览区**：
- 尺寸：宽度 100%，高度自适应
- 显示：图片居中显示，带缩放
- AI 按钮：横向排列在图片下方

**输出设置区**：
- 格式选择：Checkbox，默认勾选 ICO
- 尺寸选择：Checkbox 组，默认 16, 32, 48, 256
- 生成按钮：居中，主要按钮样式

**结果预览区**：
- 网格展示：每行 4-6 个图标预览
- 预览大小：实际尺寸的 2-4 倍显示
- 操作：悬停显示下载/复制按钮

**控件规范**：

**上传区域**：
- 宽度：100%
- 高度：200px
- 圆角：16px
- 边框：2px dashed #d1d5db
- 背景：#f9fafb

**按钮**：
- 主要按钮：背景 #6366f1 (indigo-500)，白色，圆角 12px，height 48px
- AI 按钮：背景 #f3f4f6，图标 + 文字，圆角 12px，height 40px
- 下载按钮：图标按钮，圆形或圆角

**Checkbox**：
- 尺寸：复选框组，横向排列
- 间距：每个选项 16px 间距

---

## 5. 智谱 AI 能力配置

### 5.1 使用的 AI 能力列表

| AI 能力 | 用途 | 使用场景 |
|---------|------|----------|
| GLM-4-Flash (文本理解) | AI 智能裁剪 | 用户点击"AI 裁剪"按钮时 |
| 图像生成/理解 | AI 背景去除 | 用户点击"AI 去背景"按钮时 |
| 图像增强 | AI 图像增强 | 用户点击"AI 增强"按钮时 |

### 5.2 API Key 配置

**配置方式**：用户输入智谱 AI API Key，存储在 localStorage

**交互流程**：
1. 用户首次点击 AI 功能按钮，弹出设置弹窗
2. 用户输入 API Key 并保存
3. API Key 存储到 localStorage，后续请求自动使用
4. 用户可随时通过设置按钮修改 API Key

**API Key 存储**：
- 存储键名：`image2ico_api_key`
- 存储位置：浏览器 localStorage
- 安全性提示：API Key 仅在本地使用，不上传到服务器

### 5.3 能力配置说明

**能力1：图像理解 - 智能裁剪**
- **实现方式**：使用智谱 GLM-4-Flash 分析图片，识别主体区域，返回裁剪坐标
- **调用时机**：用户点击"AI 裁剪"按钮
- **输入格式**：图片 URL 或 Base64 + prompt
- **输出格式**：裁剪后的图片 Base64

**能力2：图像理解 - 背景去除**
- **实现方式**：使用智谱 AI 图像理解能力识别主体，去除背景
- **调用时机**：用户点击"AI 去背景"按钮
- **输入格式**：图片 URL 或 Base64 + prompt
- **输出格式**：透明背景的图片 Base64

**能力3：图像增强**
- **实现方式**：使用智谱 AI 图像理解能力提升图片质量
- **调用时机**：用户点击"AI 增强"按钮
- **输入格式**：图片 URL 或 Base64 + prompt
- **输出格式**：增强后的图片 Base64

### 5.4 AI 功能 Prompt 设计

**AI 裁剪**：
```
请分析这张图片，识别出主体内容区域，返回最适合作为图标的正方形裁剪区域坐标。
返回 JSON 格式：{"x": 0, "y": 0, "width": 100, "height": 100}
```

**AI 去背景**：
```
请将这张图片的背景去除，只保留主体内容，返回透明背景的图片。
```

**AI 图像增强**：
```
请提升这张图片的清晰度和质量，进行超分辨率重建，使其更适合作为图标使用。
```

### 5.5 参考实现

参考 `/tools/ai/image-compressor` 页面的 API Key 配置方式：
- 使用 Modal 弹窗让用户输入 API Key
- 存储到 localStorage
- 提供获取 API Key 的链接

---

## 6. 技术需求

### 6.1 技术要求
- **前端框架**：Next.js 15 + React 19 + TypeScript
- **UI 组件库**：Ant Design 5 + Tailwind CSS
- **图片处理**：browser-image-compression + canvas API
- **ICO 生成**：png-to-ico 或 icns 库
- **AI 集成**：智谱 AI API (用户输入 API Key)
- **部署平台**：Vercel

### 6.2 性能要求
- 图片上传：支持最大 10MB
- 转换时间：< 2s
- AI 处理时间：< 10s（超时 60s）

### 6.3 数据要求
- 临时处理：不存储用户上传的图片
- API Key：存储在 localStorage，仅本地使用
- 无需数据库：纯前端工具

---

## 7. 优先级规划

### 7.1 第一期（MVP）
- [x] 基础上传统（拖拽、点击、粘贴、URL）
- [x] 图片转 ICO（支持多尺寸）
- [x] 图片转 PNG
- [x] 下载功能

### 7.2 第二期
- [ ] AI 智能裁剪
- [ ] AI 背景去除
- [ ] AI 图像增强

### 7.3 未来规划
- [ ] 批量转换多个图片
- [ ] 历史记录
- [ ] 一键复制到剪贴板

---

## 8. 参考产品

### 8.1 参考产品列表
- **favicon.io**：参考界面设计和交互方式
- **realfavicongenerator**：参考 ICO 生成逻辑和尺寸选项

### 8.2 差异化说明
- 本产品界面更简洁现代
- 支持多种上传方式（粘贴、URL）
- 集成 AI 增强功能

---

## 9. 待补充事项

- [x] 智谱 AI API 密钥由用户输入（参考 image-compressor）
- [ ] 是否需要复制 ICO Base64 到剪贴板功能

---

## 附录：使用说明

1. **配置智谱 AI**：用户首次使用 AI 功能时，在弹窗中输入智谱 AI API Key
2. **实现功能**：按照「功能需求」和「用户流程」部分实现功能
3. **设计界面**：按照「UI/UX 设计」部分实现界面布局和交互
4. **测试 AI 功能**：确保各 AI 功能按钮调用智谱 API 正常返回结果
5. **参考实现**：参考 `/tools/ai/image-compressor` 页面
