# 历史上的今天 - Product Spec

## 1. 产品概述

### 1.1 产品定位

查看历史上今天发生的重要事件，并提供 AI 智能解读的生活工具类 Web 应用。

### 1.2 目标用户

- **主要用户**：普通用户（娱乐消遣 + 纪念日查看）
- **使用场景**：
  1. 无聊时刷一刷，了解今天历史上发生了什么有趣的事
  2. 查看自己生日那天历史上发生了什么大事
  3. 老师/学生查看某一天的历史事件用于教育参考

### 1.3 核心价值

用户无需主动搜索，即可快速了解"历史上的今天"发生了什么重大事件，并通过 AI 获取事件的通俗化解读和相关知识扩展。

---

## 2. 功能需求

### 2.1 核心功能列表

#### 功能1：日期显示与切换

- **描述**：显示当前日期（如：2月19日），支持左右箭头切换前一天/后一天
- **输入**：点击左/右箭头
- **输出**：更新显示的日期
- **AI能力**：无

#### 功能2：历史事件列表

- **描述**：页面加载时获取"历史上的今天"事件列表，以卡片形式展示（标题、年月日、详情缩写）
- **输入**：无（首次加载时调用 API）
- **输出**：历史事件卡片列表
- **AI能力**：无

#### 功能3：事件详情展开

- **描述**：点击事件卡片展开完整详情，收起状态显示详情缩写（最多2行），展开状态显示完整详情
- **输入**：用户点击某个事件卡片
- **输出**：展开/收起详情内容
- **AI能力**：无

#### 功能4：事件信息缓存

- **描述**：将获取过的事件信息缓存到 localStorage，避免重复请求
- **输入**：已获取的事件数据
- **输出**：缓存状态提示
- **AI能力**：无

#### 功能5：AI智能解读

- **描述**：用户点击"AI解读"按钮，一键生成：总结要点、扩展知识、趣味解说，显示在事件详情下方
- **输入**：事件标题 + 事件详情内容
- **输出**：AI生成的解读内容（总结要点、扩展知识、趣味解说）
- **AI能力**：文本生成（GLM-4.5-Flash）

#### 功能6：API Key 配置

- **描述**：用户在前端配置智谱AI API Key，用于 AI 智能解读功能
- **输入**：用户输入 API Key
- **输出**：API Key 保存到 localStorage
- **AI能力**：无

### 2.2 AI 增强功能

#### AI 增强点1：历史事件智能解读

- **原始功能**：事件详情展示
- **AI 增强方式**：一键生成总结要点、扩展知识、趣味解说
- **使用场景**：用户查看事件详情后，点击"AI解读"按钮触发
- **前置条件**：用户需先配置智谱AI API Key

---

## 3. 用户流程

### 3.1 主要用户流程

**流程名称**：查看历史上的今天事件

1. **步骤1**：用户进入页面
   - 用户操作：打开页面
   - 系统响应：调用 API 获取"历史上的今天"事件列表
   - 界面状态：显示事件卡片列表（收起状态，显示详情缩写）

2. **步骤2**：用户浏览事件
   - 用户操作：滚动查看事件列表
   - 系统响应：显示历史事件卡片（包含标题、年月日、详情缩写）
   - 界面状态：卡片列表展示

3. **步骤3**：用户查看详情
   - 用户操作：点击某个事件卡片
   - 系统响应：展开完整详情内容（收起详情缩写，显示完整详情）
   - 界面状态：卡片展开

4. **步骤4**：用户获取AI解读
   - 用户操作：点击"AI解读"按钮
   - 系统响应：调用 AI 生成解读内容
   - 界面状态：事件详情下方展开显示 AI 解读内容

5. **步骤5**：用户切换日期
   - 用户操作：点击左右箭头切换前一天/后一天
   - 系统响应：更新日期显示（不调用 API，数据来自缓存）
   - 界面状态：日期更新，事件列表不变

### 3.2 异常流程

**异常情况1**：API 请求失败
- **触发条件**：网络问题或接口返回错误
- **处理方式**：显示错误提示

**异常情况2**：无历史事件数据
- **触发条件**：接口返回空数据
- **处理方式**：显示"暂无历史事件数据"提示

**异常情况3**：未配置 API Key
- **触发条件**：用户点击 AI 解读按钮但未配置 API Key
- **处理方式**：弹出设置窗口，提示用户配置 API Key

**异常情况4**：AI 解读生成失败
- **触发条件**：AI 服务调用失败
- **处理方式**：显示错误提示

---

## 4. UI/UX 设计

### 4.1 整体布局

**布局类型**：单栏上下布局

**布局结构**：
```
┌─────────────────────────────────────┐
│            Header                   │
│  历史上的今天            [设置按钮]  │
├─────────────────────────────────────┤
│         日期显示区域                │
│       <  2月19日  >                │
├─────────────────────────────────────┤
│         事件列表区域                │
│  ┌─────────────────────────────────┐│
│  │  事件标题                       ││
│  │  2016年9月9日                  ││
│  │  详情缩写...（收起状态）        ││
│  └─────────────────────────────────┘│
│  ┌─────────────────────────────────┐│
│  │  事件标题                       ││
│  │  2016年9月9日                  ││
│  │  详情缩写...（收起状态）        ││
│  └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

**展开状态**：
```
┌─────────────────────────────────────┐
│  ┌─────────────────────────────────┐│
│  │  事件标题                       ││
│  │  2016年9月9日                  ││
│  ├─────────────────────────────────┤│
│  │  完整详情内容...（展开状态）    ││
│  │                                 ││
│  │  [AI智能解读按钮]              ││
│  │  ┌───────────────────────────┐  ││
│  │  │ AI解读内容...             │  ││
│  │  └───────────────────────────┘  ││
│  └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

**各区域说明**：
- **Header**：包含标题"历史上的今天"和设置按钮（配置 API Key）
- **日期显示区域**：显示当前日期，左右箭头按钮切换前一天/后一天
- **事件列表区域**：可滚动，包含事件卡片列表

### 4.2 页面详细设计

**日期显示区域**：
- 左侧箭头：圆形按钮，点击切换前一天
- 中间日期：显示"X月X日"格式
- 右侧箭头：圆形按钮，点击切换后一天

**事件卡片（收起状态）**：
- 标题：粗体，18px
- 年月日：灰色文字，14px，格式如"2016年9月9日"
- 详情缩写：灰色文字，14px，最多显示2行

**事件卡片（展开状态）**：
- 标题：粗体，18px
- 年月日：灰色文字，14px
- 完整详情：灰色文字，14px，换行显示
- AI解读按钮：橙色渐变背景，白色文字

**控件规范**：

| 控件 | 规范 |
|------|------|
| 日期切换箭头 | 圆形按钮，48x48px，hover 背景色变化 |
| 事件卡片 | 白色背景，圆角16px，hover 轻微上浮 |
| 收起/展开图标 | 右侧箭头，收起时向下，展开时向上旋转 |
| AI解读按钮 | 橙黄渐变背景，白色文字，圆角20px |
| 设置按钮 | 右上角，图标按钮 |

### 4.3 交互行为

- **卡片收起状态**：显示标题 + 年月日 + 详情缩写（2行）
- **卡片展开状态**：显示完整详情，收起详情缩写
- **多卡片展开**：支持同时展开多个卡片，互不影响
- **日期切换**：不调用 API，使用缓存数据

---

## 5. 智谱AI 能力配置

### 5.1 使用的 AI 能力列表

| AI 能力 | 用途 | 使用场景 |
|---------|------|----------|
| GLM-4.5-Flash（文本生成） | 生成事件总结要点、扩展知识、趣味解说 | 用户点击"AI解读"按钮时 |

### 5.2 能力配置说明

**能力1：GLM-4.5-Flash 文本生成**
- **配置参数**：
  - 模型：glm-4-flash
  - temperature：0.7（适度创意）
  - max_tokens：1000
- **调用时机**：用户点击"AI解读"按钮时
- **输入格式**：事件标题 + 事件详情内容，拼接成 prompt
- **输出格式**：JSON 格式，包含三个字段：
  ```json
  {
    "summary": "一句话总结事件",
    "expansion": ["扩展知识1", "扩展知识2"],
    "fun_fact": ["趣味解说1"]
  }
  ```

**API 配置**：
- API 地址：https://open.bigmodel.cn/api/paas/v4/
- 认证方式：API Key（用户自行配置，前端传入）
- 请求方式：POST

**Prompt 示例**：
```
你是一个有趣的历史讲解员。根据以下历史事件信息，请生成：
1. 一句话总结要点（summary）
2. 扩展相关知识（expansion，2-3条）
3. 趣味解说（fun_fact，1-2条，要求通俗易懂、有趣）

事件信息：
标题：{title}
年份：{year}年{month}月{day}日
详情：{details}

请用 JSON 格式返回：
{
  "summary": "...",
  "expansion": ["...", "..."],
  "fun_fact": ["...", "..."]
}
```

**后端 API 封装**：
- 提供 `/api/ai/history-interpretation` 接口
- 接收事件信息 + API Key，返回 AI 解读结果
- API Key 由用户在前端配置

---

## 6. 技术需求

### 6.1 技术要求

- 依赖 mxnzp API 获取历史事件数据
- **API 不支持日期参数，固定返回"历史上的今天"数据**
- API 配置从环境变量读取 app_id 和 app_secret
- 事件数据缓存到 localStorage，30天有效期
- **用户需在前端配置智谱AI API Key（保存到 localStorage）**

### 6.2 性能要求

| 指标 | 要求 |
|------|------|
| 首屏加载 | < 2s |
| 日期切换 | 即时（使用缓存） |
| AI 解读生成 | < 5s |

### 6.3 数据要求

- 缓存粒度：按事件列表缓存
- 缓存有效期：30 天
- 缓存键名：`history_events_cache`

---

## 7. 优先级规划

### 7.1 第一期（MVP）

- [x] 日期显示（X月X日）
- [x] 左右箭头切换日期
- [x] 历史事件列表（卡片形式）
- [x] 收起状态显示详情缩写（2行）
- [x] 展开状态显示完整详情
- [x] 多卡片同时展开
- [x] AI智能解读功能
- [x] API Key 配置功能
- [x] 事件数据缓存

### 7.2 第二期

- [ ] 分享功能（分享到社交媒体）
- [ ] 收藏功能（收藏感兴趣的事件）

### 7.3 未来规划

- [ ] 语音播报事件（Text-to-Speech）
- [ ] 事件时间轴展示

---

## 8. 参考产品

### 8.1 参考产品列表

- **万年历工具**：参考了缓存策略
- **历史上的今天网站**：参考了数据展示方式

### 8.2 差异化说明

本产品差异化点：
1. 简洁的日期切换（不依赖日历组件）
2. AI智能解读（总结要点、扩展知识、趣味解说）vs 仅展示原始数据
3. 收起/展开状态区分展示（缩写 vs 完整详情）
4. 事件缓存机制，提升加载速度

---

## 9. 待补充事项

- [x] 所有必填项已补充完整

---

## 附录：使用说明

1. **配置 API**：在环境变量中配置 mxnzp API 的 app_id 和 app_secret
2. **用户配置 API Key**：用户需在前端设置中配置智谱AI API Key
3. **调用后端接口**：前端通过 `/api/ai/history-interpretation` 接口调用 AI 能力
4. **实现功能**：按照「功能需求」和「用户流程」部分实现功能
5. **设计界面**：按照「UI/UX 设计」部分实现界面布局和交互
